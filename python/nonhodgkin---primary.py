# Kuan V, Denaxas S, Gonzalez-Izquierdo A, Direk K, Bhatti O, Husain S, Sutaria S, Hingorani M, Nitsch D, Parisinos C, Lumbers T, Mathur R, Sofat R, Casas JP, Wong I, Hemingway H, Hingorani A, 2023.

import sys, csv, re

codes = [{"code":"B627.11","system":"readv2"},{"code":"BBg2.11","system":"readv2"},{"code":"ByuDF11","system":"readv2"},{"code":"100006.0","system":"med"},{"code":"100352.0","system":"med"},{"code":"100532.0","system":"med"},{"code":"100544.0","system":"med"},{"code":"101114.0","system":"med"},{"code":"102594.0","system":"med"},{"code":"103245.0","system":"med"},{"code":"104152.0","system":"med"},{"code":"104386.0","system":"med"},{"code":"104391.0","system":"med"},{"code":"104412.0","system":"med"},{"code":"104620.0","system":"med"},{"code":"104790.0","system":"med"},{"code":"104862.0","system":"med"},{"code":"104934.0","system":"med"},{"code":"105020.0","system":"med"},{"code":"105038.0","system":"med"},{"code":"105085.0","system":"med"},{"code":"105095.0","system":"med"},{"code":"105203.0","system":"med"},{"code":"105286.0","system":"med"},{"code":"105375.0","system":"med"},{"code":"105559.0","system":"med"},{"code":"105636.0","system":"med"},{"code":"105709.0","system":"med"},{"code":"105889.0","system":"med"},{"code":"105925.0","system":"med"},{"code":"105955.0","system":"med"},{"code":"105966.0","system":"med"},{"code":"106063.0","system":"med"},{"code":"106137.0","system":"med"},{"code":"106867.0","system":"med"},{"code":"106884.0","system":"med"},{"code":"106969.0","system":"med"},{"code":"106970.0","system":"med"},{"code":"107166.0","system":"med"},{"code":"107949.0","system":"med"},{"code":"107973.0","system":"med"},{"code":"108182.0","system":"med"},{"code":"108719.0","system":"med"},{"code":"109714.0","system":"med"},{"code":"109780.0","system":"med"},{"code":"12006.0","system":"med"},{"code":"12335.0","system":"med"},{"code":"12464.0","system":"med"},{"code":"1481.0","system":"med"},{"code":"1483.0","system":"med"},{"code":"15027.0","system":"med"},{"code":"15504.0","system":"med"},{"code":"16460.0","system":"med"},{"code":"16774.0","system":"med"},{"code":"17178.0","system":"med"},{"code":"17182.0","system":"med"},{"code":"17460.0","system":"med"},{"code":"17887.0","system":"med"},{"code":"18383.0","system":"med"},{"code":"20437.0","system":"med"},{"code":"21402.0","system":"med"},{"code":"21463.0","system":"med"},{"code":"21549.0","system":"med"},{"code":"23711.0","system":"med"},{"code":"26111.0","system":"med"},{"code":"27416.0","system":"med"},{"code":"27562.0","system":"med"},{"code":"27965.0","system":"med"},{"code":"28639.0","system":"med"},{"code":"31492.0","system":"med"},{"code":"31576.0","system":"med"},{"code":"31726.0","system":"med"},{"code":"31749.0","system":"med"},{"code":"31794.0","system":"med"},{"code":"3371.0","system":"med"},{"code":"33869.0","system":"med"},{"code":"34089.0","system":"med"},{"code":"34352.0","system":"med"},{"code":"35014.0","system":"med"},{"code":"3604.0","system":"med"},{"code":"36114.0","system":"med"},{"code":"38005.0","system":"med"},{"code":"39798.0","system":"med"},{"code":"39883.0","system":"med"},{"code":"39906.0","system":"med"},{"code":"40513.0","system":"med"},{"code":"40766.0","system":"med"},{"code":"41369.0","system":"med"},{"code":"41754.0","system":"med"},{"code":"41841.0","system":"med"},{"code":"42579.0","system":"med"},{"code":"44318.0","system":"med"},{"code":"44617.0","system":"med"},{"code":"45264.0","system":"med"},{"code":"46877.0","system":"med"},{"code":"46931.0","system":"med"},{"code":"46967.0","system":"med"},{"code":"48253.0","system":"med"},{"code":"49253.0","system":"med"},{"code":"49262.0","system":"med"},{"code":"50668.0","system":"med"},{"code":"50695.0","system":"med"},{"code":"50696.0","system":"med"},{"code":"51680.0","system":"med"},{"code":"5179.0","system":"med"},{"code":"51852.0","system":"med"},{"code":"51895.0","system":"med"},{"code":"52591.0","system":"med"},{"code":"53551.0","system":"med"},{"code":"54190.0","system":"med"},{"code":"57427.0","system":"med"},{"code":"57737.0","system":"med"},{"code":"58015.0","system":"med"},{"code":"58082.0","system":"med"},{"code":"58953.0","system":"med"},{"code":"58962.0","system":"med"},{"code":"59115.0","system":"med"},{"code":"60092.0","system":"med"},{"code":"60242.0","system":"med"},{"code":"60275.0","system":"med"},{"code":"60504.0","system":"med"},{"code":"61146.0","system":"med"},{"code":"61251.0","system":"med"},{"code":"62380.0","system":"med"},{"code":"62437.0","system":"med"},{"code":"63105.0","system":"med"},{"code":"63375.0","system":"med"},{"code":"63699.0","system":"med"},{"code":"63723.0","system":"med"},{"code":"63973.0","system":"med"},{"code":"63994.0","system":"med"},{"code":"64336.0","system":"med"},{"code":"64515.0","system":"med"},{"code":"64670.0","system":"med"},{"code":"64947.0","system":"med"},{"code":"65180.0","system":"med"},{"code":"65701.0","system":"med"},{"code":"66327.0","system":"med"},{"code":"66367.0","system":"med"},{"code":"66603.0","system":"med"},{"code":"67203.0","system":"med"},{"code":"67518.0","system":"med"},{"code":"68353.0","system":"med"},{"code":"68964.0","system":"med"},{"code":"69301.0","system":"med"},{"code":"69767.0","system":"med"},{"code":"69980.0","system":"med"},{"code":"70374.0","system":"med"},{"code":"70509.0","system":"med"},{"code":"70740.0","system":"med"},{"code":"70842.0","system":"med"},{"code":"71031.0","system":"med"},{"code":"71117.0","system":"med"},{"code":"71238.0","system":"med"},{"code":"71262.0","system":"med"},{"code":"71304.0","system":"med"},{"code":"71619.0","system":"med"},{"code":"71625.0","system":"med"},{"code":"71652.0","system":"med"},{"code":"72196.0","system":"med"},{"code":"72241.0","system":"med"},{"code":"72433.0","system":"med"},{"code":"72714.0","system":"med"},{"code":"72725.0","system":"med"},{"code":"7940.0","system":"med"},{"code":"8649.0","system":"med"},{"code":"90201.0","system":"med"},{"code":"91674.0","system":"med"},{"code":"92068.0","system":"med"},{"code":"92380.0","system":"med"},{"code":"94995.0","system":"med"},{"code":"95012.0","system":"med"},{"code":"95058.0","system":"med"},{"code":"95464.0","system":"med"},{"code":"95545.0","system":"med"},{"code":"95715.0","system":"med"},{"code":"95949.0","system":"med"},{"code":"96379.0","system":"med"},{"code":"97577.0","system":"med"},{"code":"97756.0","system":"med"},{"code":"97852.0","system":"med"},{"code":"98596.0","system":"med"},{"code":"98961.0","system":"med"},{"code":"99240.0","system":"med"},{"code":"99655.0","system":"med"},{"code":"99695.0","system":"med"},{"code":"99887.0","system":"med"},{"code":"99951.0","system":"med"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('non-hodgkin-lymphoma-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["nonhodgkin---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["nonhodgkin---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["nonhodgkin---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
